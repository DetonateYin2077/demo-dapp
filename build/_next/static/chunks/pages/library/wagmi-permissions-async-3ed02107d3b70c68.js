(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2284],{26653:function(e,r,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/library/wagmi-permissions-async",function(){return s(86637)}])},86637:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return ei}});var i=s(97458),t=s(36346),n=s(12467),o=s(86256),a=s(31213),c=s(53840),l=s(49636),d=s(62352),u=s(89192),p=s(52876),h=s(25341),x=s(72365),f=s(74631),m=s(44584),y=s(5451),j=s(11098),v=s(3494),w=s(88944),g=s(35465),b=s(52983),P=s(38966),E=s(79879),k=s(99355),C=s(86228),N=s(11962),K=s(41211),_=s(22918),S=s(76950),L=s(79815),R=s(29290);let T=(0,b.createContext)({privateKey:void 0,signer:void 0});function z(e){let{children:r}=e,s=(0,P.p)(),[t,n]=(0,R.R)(K.aK,void 0),[o,a]=(0,b.useState)();return(0,b.useEffect)(()=>{try{let e=(0,K.le)(K.aK);if(!e){let r=(0,S.NC)(_.secp256k1.utils.randomPrivateKey());n(r),e=r}let r=(0,L.L)(e);a(r)}catch(e){s({title:"Failure",description:"No private key available",type:"error"})}},[]),(0,i.jsx)(T.Provider,{value:{privateKey:t,signer:o},children:r})}function I(){let e=(0,b.useContext)(T);if(void 0===e)throw Error("useLocalEcdsaKey must be used within a LocalEcdsaKeyProvider");return e}var D=s(90398),F=s(75223),O=s(43939),q=s(91895);function U(){let{provider:e,supported:r}=(0,N.C)({method:C.nf.WALLET_GRANT_PERMISSIONS}),{address:s,isConnected:n}=(0,t.Tj)(),{chain:o}=(0,w.m)();return n&&e&&s&&o?r?(0,i.jsx)(X,{chain:o,provider:e,address:s}):(0,i.jsx)(j.x,{fontSize:"md",color:"yellow",children:"Wallet does not support wallet_grantPermissions rpc method"}):(0,i.jsx)(j.x,{fontSize:"md",color:"yellow",children:"Wallet not connected"})}function X(e){let{chain:r,provider:s,address:t}=e,{grantedPermissions:n,clearGrantedPermissions:o,grantPermissions:a}=(0,F.S)(),{signer:c}=I(),[l,d]=(0,b.useState)(!1),u=(0,P.p)(),p=(0,b.useCallback)(async()=>{d(!0);try{if(!c)throw Error("PrivateKey signer not available");if(!s)throw Error("No Provider available, Please connect your wallet.");let e=(0,E.K)({account:t,chain:r,transport:(0,k.P)(s)}).extend((0,g.l)()),i=(0,O.tp)(),n=await a(e,{permissions:i,signerKey:{key:c.publicKey,type:q.yu.secp256k1}});u({type:"success",title:"Permissions Granted",description:JSON.stringify(n.approvedPermissions,D.d)})}catch(e){u({type:"error",title:"Request Permissions Errors",description:e instanceof Error?e.message:"Unknown Error"})}finally{d(!1)}},[c,s,t,r,a,u]);return(0,i.jsxs)(f.K,{direction:["column","column","row"],children:[(0,i.jsx)(v.z,{"data-test-id":"request-permissions-button",onClick:p,isDisabled:!!(l||n),isLoading:l,children:"Request Permissions"}),(0,i.jsx)(v.z,{"data-test-id":"clear-permissions-button",onClick:o,isDisabled:!n,children:"Clear Permissions"})]})}var M=s(18394),W=s(13637),A=s(86802),J=s(3766),B=s(50554),G=s(20216);function H(){var e;let{privateKey:r}=I(),{grantedPermissions:s,pci:t}=(0,F.S)(),{data:n,refetch:o,isLoading:a,isRefetching:c}=(0,W.u)({abi:B.M,address:B.L,functionName:"getBalance",args:[(null==s?void 0:null===(e=s.signerData)||void 0===e?void 0:e.submitToAddress)||"0x"]}),[l,d]=(0,b.useState)(!1),u=(0,P.p)();async function p(){d(!0);try{if(!r)throw Error("Unable to get dApp private key");if(!s)throw Error("No permissions available");if(!t)throw Error("No WC cosigner data(PCI) available");let e=(0,A.R)({abi:B.M,functionName:"purchase",args:[1]}),i=[{to:B.L,value:(0,J.f)("0.0001"),data:e}],n=await (0,O.wu)({actions:i,chain:G.F,ecdsaPrivateKey:r,permissions:s,pci:t});n&&(u({title:"UserOp submitted successfully",description:"UserOp Hash: ".concat(n),type:"success"}),await o())}catch(e){u({title:"Transaction Failed",description:"".concat(e),type:"error"})}d(!1)}return s?(0,i.jsxs)(f.K,{direction:["column","column","row"],children:[(0,i.jsx)(v.z,{isDisabled:!s,isLoading:l,onClick:p,children:"Purchase Donut"}),(0,i.jsx)(M.k,{alignItems:"center",children:a||c?(0,i.jsx)(j.x,{children:"Fetching donuts..."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.x,{marginRight:"5px",children:"Crypto donuts left:"}),(0,i.jsx)(j.x,{children:null==n?void 0:n.toString()})]})})]}):(0,i.jsx)(j.x,{fontSize:"md",color:"yellow",children:"Dapp does not have the permissions"})}function Z(){return(0,i.jsxs)(u.Z,{marginTop:10,marginBottom:10,children:[(0,i.jsx)(p.O,{children:(0,i.jsx)(h.X,{size:"md",children:"Test Interactions"})}),(0,i.jsx)(x.e,{children:(0,i.jsxs)(f.K,{divider:(0,i.jsx)(m.c,{}),spacing:"4",children:[(0,i.jsxs)(y.xu,{children:[(0,i.jsx)(h.X,{size:"xs",textTransform:"uppercase",pb:"2",children:"Request Permissions"}),(0,i.jsx)(U,{})]}),(0,i.jsxs)(y.xu,{children:[(0,i.jsx)(h.X,{size:"xs",textTransform:"uppercase",pb:"2",children:"Purchase Donut With Permissions"}),(0,i.jsx)(H,{})]})]})})]})}var Q=s(26913),V=s(34343),Y=s(47229);let $=new n.S,ee=[Q.RJ,Q.v4,Q.yu,Q.jM,Q.yX,Q.Fo],er=new V.Ks({ssr:!0,networks:ee,projectId:d.bq.ProjectId}),es=(0,t.cz)({adapters:[er],networks:ee,defaultNetwork:Q.RJ,projectId:d.bq.ProjectId,features:{analytics:!0},termsConditionsUrl:"https://reown.com/terms-of-service",privacyPolicyUrl:"https://reown.com/privacy-policy"});function ei(){return(0,i.jsx)(a.F,{config:er.wagmiConfig,children:(0,i.jsx)(o.aH,{client:$,children:(0,i.jsx)(Y.L,{children:(0,i.jsxs)(z,{children:[(0,i.jsx)(c.v,{}),(0,i.jsx)(Z,{})]})})})})}l.i.setModal(es)}},function(e){e.O(0,[2361,4720,580,7677,4247,2918,5124,4953,2759,3980,2888,9774,179],function(){return e(e.s=26653)}),_N_E=e.O()}]);