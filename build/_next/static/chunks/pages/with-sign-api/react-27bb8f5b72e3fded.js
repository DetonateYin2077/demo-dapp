(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[419],{557:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/with-sign-api/react",function(){return r(1654)}])},3339:function(e,t,r){"use strict";r.d(t,{FI:function(){return n},Qf:function(){return a},T_:function(){return i},ph:function(){return o}});let n={name:"WalletConnectModal Lab",description:"WalletConnectModal Laboratory",url:"lab.web3modal.com",icons:["https://walletconnect.com/_next/static/media/logo_mark.84dd8525.svg"]},o={requiredNamespaces:{eip155:{methods:["eth_sendTransaction","personal_sign"],chains:["eip155:1"],events:["chainChanged","accountsChanged"]}}},i={statement:"Connect to WalletConnectModal Lab"};function a(e,t){return{topic:e,chainId:"eip155:1",request:{method:"personal_sign",params:["0x48656c6c6f20576562334d6f64616c",t]}}}},1654:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var n=r(9980),o=r(1326),i=r(5655),a=r(28),s=r(6091),p=r(9074),c=r(2363),l=r(4412),u=r(9299),f=r(106),_=r(3339),h=r(1744);function d(){let[e,t]=(0,c.useState)(!1),[r,d]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let e=localStorage.getItem("isOpenOverridden"),t="true"===e,r=async()=>{if(t){let e=await (0,p.isTelegramEnvironment)();if(!e)return;let t=(0,p.overrideWindowOpen)();d(t)}};r()},[]);let m=(0,l.kP)(),{request:w}=(0,l.QT)({topic:null==m?void 0:m.topic,chainId:"eip155:1",request:{method:"personal_sign",params:["0x48656c6c6f20576562334d6f64616c",null==m?void 0:m.namespaces.eip155.accounts[0]]}}),{disconnect:b}=(0,l.qL)({topic:null==m?void 0:m.topic,reason:(0,u.D6)("USER_DISCONNECTED")}),{connect:g}=(0,l.$4)(_.ph);async function y(){try{t(!1);let e=await g();f.G.open("Connect",JSON.stringify(e,null,2))}catch(t){let e=(0,h.e)(t);(0,h.E)(e)}}async function v(){try{let e=await w({topic:null==m?void 0:m.topic,chainId:"eip155:1",request:{method:"personal_sign",params:["0x48656c6c6f20576562334d6f64616c",null==m?void 0:m.namespaces.eip155.accounts[0]]}});f.G.open("Sign Message",JSON.stringify(e,null,2))}catch(t){let e=(0,h.e)(t);(0,h.E)(e)}}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.ZP,{css:{maxWidth:"400px",margin:"100px auto"},variant:"bordered",children:(0,n.jsxs)(o.ZP.Body,{css:{justifyContent:"center",alignItems:"center",height:"200px"},children:[(0,n.jsxs)("div",{children:["是否已重载成功:",r.toString()]}),m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.ZP,{shadow:!0,color:"primary",onPress:v,children:"Sign Message"}),(0,n.jsx)(a.Z,{}),(0,n.jsx)(i.ZP,{shadow:!0,color:"error",onPress:function(){if(!e){t(!0);try{b()}catch(t){let e=(0,h.e)(t);(0,h.E)(e)}}},disabled:e,children:e?(0,n.jsx)(s.ZP,{size:"xs",color:"white"}):"Disconnect"})]}):(0,n.jsx)(i.ZP,{shadow:!0,color:"primary",onPress:y,children:"Connect"})]})}),(0,n.jsx)(l.gQ,{projectId:"374485c101d083e7e43f6cd4b3665e34",modalOptions:{themeMode:"dark"},metadata:_.FI})]})}},1744:function(e,t,r){"use strict";r.d(t,{E:function(){return o},e:function(){return i}});var n=r(1490);function o(e){n.C.error(e,{duration:2e3})}function i(e){return e instanceof Error?e.message:"Something went wrong..."}},9074:function(e,t,r){!function(e,t){"use strict";var r,n=Object.defineProperty,o=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,i=(e,t,r)=>(o(e,"symbol"!=typeof t?t+"":t,r),r);function a(e,t){let r;let n=()=>{void 0!==r&&t&&t(r),r=void 0};return[()=>void 0===r?r=e(n):r,n]}let s=new class{constructor(e,t={}){this.scope=e,this.options=t}print(e,...t){let r=new Date,n=Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(r),{textColor:o,bgColor:i}=this.options,a="font-weight: bold;padding: 0 5px;border-radius:5px";console[e](`%c${n}%c / %c${this.scope}`,`${a};background-color: lightblue;color:black`,"",`${a};${o?`color:${o};`:""}${i?`background-color:${i}`:""}`,...t)}error(...e){this.print("error",...e)}log(...e){this.print("log",...e)}}("SDK",{bgColor:"forestgreen",textColor:"white"});class p{constructor(){i(this,"listeners",new Map),i(this,"listenersCount",0),i(this,"subscribeListeners",[])}clear(){this.listeners.clear(),this.subscribeListeners=[]}get count(){return this.listenersCount+this.subscribeListeners.length}emit(e,...t){this.subscribeListeners.forEach(r=>r({event:e,args:t})),(this.listeners.get(e)||[]).forEach(([r,n])=>{r(...t),n&&this.off(e,r)})}on(e,t,r){let n=this.listeners.get(e);return n||this.listeners.set(e,n=[]),n.push([t,r]),this.listenersCount+=1,()=>this.off(e,t)}off(e,t){let r=this.listeners.get(e)||[];for(let e=0;e<r.length;e+=1)if(t===r[e][0]){r.splice(e,1),this.listenersCount-=1;return}}subscribe(e){return this.subscribeListeners.push(e),()=>this.unsubscribe(e)}unsubscribe(e){for(let t=0;t<this.subscribeListeners.length;t+=1)if(this.subscribeListeners[t]===e){this.subscribeListeners.splice(t,1);return}}}function c(e,t,r){return window.addEventListener(e,t,r),()=>window.removeEventListener(e,t,r)}function l(...e){let t=!1,r=e.flat(1);return[e=>!t&&r.push(e),()=>{t||(t=!0,r.forEach(e=>e()))},t]}class u extends Error{constructor(e,t,r){super(t,{cause:r}),this.type=e,Object.setPrototypeOf(this,u.prototype)}}function f(e,t,r){return new u(e,t,r)}let _="ERR_PARSE";function h(){return f("ERR_UNEXPECTED_TYPE","Value has unexpected type")}class d{constructor(e,t,r){this.parser=e,this.isOptional=t,this.type=r}parse(e){if(!(this.isOptional&&void 0===e))try{return this.parser(e)}catch(e){throw f(_,`Unable to parse value${this.type?` as ${this.type}`:""}`,e)}}optional(){return this.isOptional=!0,this}}function m(e,t){return()=>new d(e,!1,t)}let w=m(e=>{if("boolean"==typeof e)return e;let t=String(e);if("1"===t||"true"===t)return!0;if("0"===t||"false"===t)return!1;throw h()},"boolean");function b(e,t){let r={};for(let n in e){let o,i;let a=e[n];if(a){if("function"==typeof a||"parse"in a)o=n,i="function"==typeof a?a:a.parse.bind(a);else{let{type:e}=a;o=a.from||n,i="function"==typeof e?e:e.parse.bind(e)}try{let e=i(t(o));void 0!==e&&(r[n]=e)}catch(e){throw f(_,`Unable to parse field "${n}"`,e)}}}return r}function g(e){let t=e;if("string"==typeof t&&(t=JSON.parse(t)),"object"!=typeof t||null===t||Array.isArray(t))throw h();return t}function y(e,t){return new d(t=>{let r=g(t);return b(e,e=>r[e])},!1,t)}let v=m(e=>{if("number"==typeof e)return e;if("string"==typeof e){let t=Number(e);if(!Number.isNaN(t))return t}throw h()},"number"),E=m(e=>{if("string"==typeof e||"number"==typeof e)return e.toString();throw h()},"string");function P(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(e=>{delete window[e]})}function x(e,t){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:e,eventData:t}),source:window.parent}))}let T={clipboard_text_received:y({req_id:E(),data:e=>null===e?e:E().optional().parse(e)}),custom_method_invoked:y({req_id:E(),result:e=>e,error:E().optional()}),popup_closed:{parse:e=>y({button_id:e=>null==e?void 0:E().parse(e)}).parse(e??{})},viewport_changed:y({height:v(),width:e=>null==e?window.innerWidth:v().parse(e),is_state_stable:w(),is_expanded:w()})},[S,O]=a(e=>{let[t,r]=function(){let e=new p,t=new p;t.subscribe(t=>{e.emit("event",{name:t.event,payload:t.args[0]})}),[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(e=>{let t=window;e.forEach((e,r,n)=>{if(r===n.length-1){t[e]=x;return}e in t||(t[e]={}),t=t[e]})});let[,r]=l(P,c("resize",()=>{t.emit("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}),c("message",e=>{let r;if(e.source!==window.parent)return;try{var n;n=e.data,r=y({eventType:E(),eventData:e=>e}).parse(n)}catch{return}let{eventType:o,eventData:i}=r,a=T[o];try{let e=a?a.parse(i):i;t.emit(...e?[o,e]:[o])}catch(e){s.error(`An error occurred processing the "${o}" event from the Telegram application.
Please, file an issue here:
https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose`,r,e)}}),()=>e.clear(),()=>t.clear());return[{on:t.on.bind(t),off:t.off.bind(t),subscribe:t=>e.on("event",t),unsubscribe(t){e.off("event",t)},get count(){return t.count+e.count}},r]}(),n=t.off.bind(t);return t.off=(r,o)=>{let{count:i}=t;n(r,o),i&&!t.count&&e()},[t,r]},([,e])=>e());function k(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function A(e,t){return 0>=function(e,t){let r=e.split("."),n=t.split("."),o=Math.max(r.length,n.length);for(let e=0;e<o;e+=1){let t=parseInt(r[e]||"0",10),o=parseInt(n[e]||"0",10);if(t!==o)return t>o?1:-1}return 0}(e,t)}function C(e,t,r){if("string"==typeof r){if("web_app_open_link"===e){if("try_instant_view"===t)return A("6.4",r);if("try_browser"===t)return A("7.6",r)}if("web_app_set_header_color"===e&&"color"===t)return A("6.9",r);if("web_app_close"===e&&"return_back"===t)return A("7.6",r)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return A("6.1",t);case"web_app_open_popup":return A("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return A("6.4",t);case"web_app_switch_inline_query":return A("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return A("6.9",t);case"web_app_setup_settings_button":return A("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return A("7.2",t);case"web_app_setup_swipe_behavior":return A("7.7",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function R(e){return"TelegramWebviewProxy"in e&&k(e.TelegramWebviewProxy)&&"postEvent"in e.TelegramWebviewProxy&&"function"==typeof e.TelegramWebviewProxy.postEvent}function W(e,t,r){var n;let o={},i;if(t||r?t&&r?(o=r,i=t):t&&("targetOrigin"in t?o=t:i=t):o={},function(){try{return window.self!==window.top}catch{return!0}}())return window.parent.postMessage(JSON.stringify({eventType:e,eventData:i}),o.targetOrigin||"https://web.telegram.org");if("external"in(n=window)&&k(n.external)&&"notify"in n.external&&"function"==typeof n.external.notify){window.external.notify(JSON.stringify({eventType:e,eventData:i}));return}if(R(window)){window.TelegramWebviewProxy.postEvent(e,JSON.stringify(i));return}throw f("ERR_UNKNOWN_ENV","Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside the Telegram application environment.")}async function $(e){let t;let r=new Promise(e=>t=e),{event:n,capture:o,timeout:i}=e,[,a]=l((Array.isArray(n)?n:[n]).map(e=>S()[0].on(e,r=>{(!o||(Array.isArray(n)?o({event:e,payload:r}):o(r)))&&t(r)},void 0)));try{return(e.postEvent||W)(e.method,e.params),await (i?Promise.race(["function"==typeof r?r():r,new Promise((e,t)=>{setTimeout(()=>{t(f("ERR_TIMED_OUT",`Timeout reached: ${i}ms`))},i)})]):r)}finally{a()}}let N=m(e=>e instanceof Date?e:new Date(1e3*v().parse(e)),"Date");function L(e,t){return new d(t=>{if("string"!=typeof t&&!(t instanceof URLSearchParams))throw h();let r="string"==typeof t?new URLSearchParams(t):t;return b(e,e=>{let t=r.get(e);return null===t?void 0:t})},!1,t)}let D=y({id:v(),type:E(),title:E(),photoUrl:{type:E().optional(),from:"photo_url"},username:E().optional()},"Chat").optional(),I=y({addedToAttachmentMenu:{type:w().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:w().optional(),from:"allows_write_to_pm"},firstName:{type:E(),from:"first_name"},id:v(),isBot:{type:w().optional(),from:"is_bot"},isPremium:{type:w().optional(),from:"is_premium"},languageCode:{type:E().optional(),from:"language_code"},lastName:{type:E().optional(),from:"last_name"},photoUrl:{type:E().optional(),from:"photo_url"},username:E().optional()},"User").optional(),U=m(e=>(function(e){let t=e.replace(/\s/g,"").toLowerCase();if(/^#[\da-f]{6}$/i.test(t))return t;if(/^#[\da-f]{3}$/i.test(t)){let e="#";for(let r=0;r<3;r+=1)e+=t[1+r].repeat(2);return e}let r=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!r)throw Error(`Value "${e}" does not satisfy any of known RGB formats.`);return r.slice(1).reduce((e,t)=>{let r=parseInt(t,10).toString(16);return e+(1===r.length?"0":"")+r},"#")})(E().parse(e)),"rgb"),q=m(e=>{let t=U().optional();return Object.entries(g(e)).reduce((e,[r,n])=>(e[r.replace(/_[a-z]/g,e=>e[1].toUpperCase())]=t.parse(n),e),{})},"ThemeParams");function j(e){return L({botInline:{type:w().optional(),from:"tgWebAppBotInline"},initData:{type:L({authDate:{type:N(),from:"auth_date"},canSendAfter:{type:v().optional(),from:"can_send_after"},chat:D,chatInstance:{type:E().optional(),from:"chat_instance"},chatType:{type:E().optional(),from:"chat_type"},hash:E(),queryId:{type:E().optional(),from:"query_id"},receiver:I,startParam:{type:E().optional(),from:"start_param"},user:I},"InitData").optional(),from:"tgWebAppData"},initDataRaw:{type:E().optional(),from:"tgWebAppData"},platform:{type:E(),from:"tgWebAppPlatform"},showSettings:{type:w().optional(),from:"tgWebAppShowSettings"},startParam:{type:E().optional(),from:"tgWebAppStartParam"},themeParams:{type:q(),from:"tgWebAppThemeParams"},version:{type:E(),from:"tgWebAppVersion"}}).parse(e)}function M(e){return j(e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function J(){return M(window.location.href)}function Z(){return performance.getEntriesByType("navigation")[0]}function V(){let e=Z();if(!e)throw Error("Unable to get first navigation entry.");return M(e.name)}function B(e){return`telegram-apps/${e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}`}function G(e,t){sessionStorage.setItem(B(e),JSON.stringify(t))}function F(e){let t=sessionStorage.getItem(B(e));try{return t?JSON.parse(t):void 0}catch{}}function z(){return j(F("launchParams")||"")}let[H]=a(function(){let e=0;return()=>(e+=1).toString()});class Q{constructor(e,t){i(this,"supports"),this.supports=r=>C(t[r],e)}}function X(e,t){return e.startsWith(t)?e:`${t}${e}`}class K extends Q{constructor(e,t,r){var n;super(e,{readTextFromClipboard:"web_app_read_text_from_clipboard"}),i(this,"supportsParam"),this.version=e,this.createRequestId=t,this.postEvent=r,this.supportsParam=(n={"openLink.tryInstantView":["web_app_open_link","try_instant_view"]},t=>{let[r,o]=n[t];return C(r,o,e)})}openLink(e,t){let r=new URL("string"==typeof e?e:`${e.pathname||""}${X(e.search||"","?")}${X(e.hash||"","#")}`,"http://a").toString();if(!C("web_app_open_link",this.version)){window.open(r,"_blank");return}let n="boolean"==typeof t?{tryInstantView:t}:t||{};this.postEvent("web_app_open_link",{url:r,try_browser:n.tryBrowser,try_instant_view:n.tryInstantView})}openTelegramLink(e){let{hostname:t,pathname:r,search:n}=new URL(e,"https://t.me");if("t.me"!==t)throw Error(`URL has not allowed hostname: ${t}. Only "t.me" is allowed`);if(!C("web_app_open_tg_link",this.version)){window.location.href=e;return}this.postEvent("web_app_open_tg_link",{path_full:r+n})}async readTextFromClipboard(){let e=this.createRequestId(),{data:t=null}=await $({method:"web_app_read_text_from_clipboard",event:"clipboard_text_received",postEvent:this.postEvent,params:{req_id:e},capture:({req_id:t})=>t===e});return t}shareURL(e,t){this.openTelegramLink("https://t.me/share/url?"+new URLSearchParams({url:e,text:t||""}).toString().replace(/\+/g,"%20"))}}let Y=(r=({version:e,postEvent:t,createRequestId:r})=>new K(e,r,t),()=>{var e;let t=function(){let e=[];for(let t of[J,V,z])try{let e=t();return G("launchParams",function(e){let{initDataRaw:t,themeParams:r,platform:n,version:o,showSettings:i,startParam:a,botInline:s}=e,p=new URLSearchParams;return p.set("tgWebAppPlatform",n),p.set("tgWebAppThemeParams",JSON.stringify(Object.fromEntries(Object.entries(r).map(([e,t])=>[e.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`),t])))),p.set("tgWebAppVersion",o),t&&p.set("tgWebAppData",t),a&&p.set("tgWebAppStartParam",a),"boolean"==typeof i&&p.set("tgWebAppShowSettings",i?"1":"0"),"boolean"==typeof s&&p.set("tgWebAppBotInline",s?"1":"0"),p.toString()}(e)),e}catch(t){e.push(t instanceof Error?t.message:JSON.stringify(t))}throw Error([`Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?
`,"\uD83D\uDCD6 Refer to docs for more information:",`https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment
`,"Collected errors:",e.map(e=>`— ${e}`)].join(`
`))}(),n={...t,postEvent:(e=t.version,(t,r)=>{if(!C(t,e))throw f("ERR_METHOD_UNSUPPORTED",`Method "${t}" is unsupported in Mini Apps version ${e}`);if(k(r)&&"web_app_set_header_color"===t&&"color"in r&&!C(t,"color",e))throw f("ERR_METHOD_PARAMETER_UNSUPPORTED",`Parameter "color" of "${t}" method is unsupported in Mini Apps version ${e}`);return W(t,r)}),createRequestId:H()};if("function"==typeof r)return r(n);let[o,i,a]=l(),s=(void 0)({...n,state:!function(){let e=Z();return!!(e&&"reload"===e.type)}()?void 0:F(r),addCleanup:o}),p=e=>(a||o(e.on("change",e=>{G(r,e)})),e);return[s instanceof Promise?s.then(p):p(s),i]});async function ee(){if(R(window))return!0;try{return await $({method:"web_app_request_theme",event:"theme_changed",timeout:100}),!0}catch{return!1}}e.isTelegramEnvironment=function(){return t.__awaiter(this,void 0,void 0,function*(){return Y(),yield ee()})},e.overrideWindowOpen=function(){let e=Y();return window.open=(t,...r)=>{try{t.startsWith("tg://")||t.includes("t.me")?e.openTelegramLink(t):e.openLink(t)}catch(e){console.error("open with tg methods failed",e)}return null},!0}}(t,r(443))},3331:function(){}},function(e){e.O(0,[554,776,444,774,888,179],function(){return e(e.s=557)}),_N_E=e.O()}]);